!2 Narrative
As a platform I want to handle a get actual power usage response in order to show actual power usage of a device

'''''NOTE: Authorisation is tested in Basic OSGP Functions - PBI119'''''

!2 Implemented Scenarios:
 * Successfully get actual power usage
 * Unsuccessfully get actual power usage

!2 Scenario: Successfully get actual power usage
-| scenario | get actual power usage success matrix |device||status||recordTime||meterType||totalConsumedEnergy||actualConsumedPower||psldData||actualCurrent1||actualCurrent2||actualCurrent3||actualPower1||actualPower2||actualPower3||averagePowerFactor1||averagePowerFactor2||averagePowerFactor3||relayData1Index||relayData1LightingMinutes||relayData2Index||relayData2LightingMinutes||ismessagesent||result||description |
|given|a get actual power usage request for device @device                                                                                                                                                                                                                                                                                                                                                             |
|and  |the get actual power usage request refers to a device @device with status @status                                                                                                                                                                                                                                                                                                                               |
|and  |the get actual power usage request refers to an organisation that is authorised                                                                                                                                                                                                                                                                                                                                 |
|and  |the get actual power usage oslp message from the device contains @recordTime, @meterType, @totalConsumedEnergy, @actualConsumedPower, @psldData, @actualCurrent1, @actualCurrent2, @actualCurrent3, @actualPower1, @actualPower2, @actualPower3, @averagePowerFactor1, @averagePowerFactor2, @averagePowerFactor3, @relayData1Index, @relayData1LightingMinutes, @relayData2Index and @relayData2LightingMinutes|
|when |the get actual power usage request is received                                                                                                                                                                                                                                                                                                                                                                  |
|then |the get actual power usage request should return an async response with a correlationId and deviceId @device                                                                                                                                                                                                                                                                                                    |
|and  |a get actual power usage oslp message is sent to the device @device should be @ismessagesent                                                                                                                                                                                                                                                                                                                    |
|and  |an ovl get actual power usage result message with result @result and description @description should be sent to the ovl out queue                                                                                                                                                                                                                                                                               |


-| get actual power usage success matrix | 
|device   |status|recordTime    |meterType|totalConsumedEnergy|actualConsumedPower|psldData|actualCurrent1|actualCurrent2|actualCurrent3|actualPower1|actualPower2|actualPower3|averagePowerFactor1|averagePowerFactor2|averagePowerFactor3|relayData1Index|relayData1LightingMinutes|relayData2Index|relayData2LightingMinutes|ismessagesent|result|description|
|device-01|active|20130202120000|AUX      |                   |                   |        |              |              |              |            |            |            |                   |                   |                   |               |                         |               |                         |true         |OK    |           |
|device-01|active|20140101120000|PULSE    |200                |1000               |100     |200           |200           |300           |100         |100         |100         |100                |100                |100                |1              |600                      |2              |480                      |true         |OK    |           |
|device-01|active|20130202120000|AUX      |10                 |1                  |1       |1             |1             |1             |1           |1           |1           |1                  |1                  |1                  |1              |600                      |2              |480                      |true         |OK    |           |
|device-01|active|20130202120000|P1       |10                 |10                 |10      |10            |10            |10            |10          |10          |10          |10                 |10                 |10                 |1              |600                      |2              |480                      |true         |OK    |           |
|device-01|active|20130202120000|PULSE    |                   |200                |90      |90            |              |90            |90          |            |            |                   |                   |                   |               |                         |               |                         |true         |OK    |           |
|device-01|active|20140101120000|AUX      |                   |90                 |        |90            |              |90            |90          |            |            |                   |                   |                   |               |                         |               |                         |true         |OK    |           |

!2 Parameters:
 * device: device identification
 * status: active, unknown, unregistered; should always be active for success scenario
 * powerusagedata: the actual power usage data
 * correlationId: correlationId of the message
 * isgenerated: boolean (true/false) indicating whether a correlationID is generated
 * isqueued: boolean (true/false) indicating whether a message is added to the queue
 * result: OK (correlationID is returned) or exception

!2 Scenario: Receive A Get get actual power usage Response Request
-| scenario | get get actual power usage response input values | correlationid || deviceid || isfound || deviceid2 || qresult || qdescription || recordTime    ||meterType||totalConsumedEnergy||actualConsumedPower||psldData||actualCurrent1||actualCurrent2||actualCurrent3||actualPower1||actualPower2||actualPower3||averagePowerFactor1||averagePowerFactor2||averagePowerFactor3||relayData1Index||relayData1LightingMinutes||relayData2Index||relayData2LightingMinutes||result || description|
|given|a get get actual power usage response request with correlationId @correlationid and deviceId @deviceid                                                                                                                                                                                                                                                                                                                                                                                                                     |
|and  |a get actual power usage response message with correlationId @correlationid, deviceId @deviceid2, qresult @qresult, qdescription @qdescription, @recordTime, @meterType, @totalConsumedEnergy, @actualConsumedPower, @psldData, @actualCurrent1, @actualCurrent2, @actualCurrent3, @actualPower1, @actualPower2, @actualPower3, @averagePowerFactor1, @averagePowerFactor2, @averagePowerFactor3, @relayData1Index, @relayData1LightingMinutes, @relayData2Index, @relayData2LightingMinutes is found in the queue @isfound|
|when |the get get actual power usage response request is received                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|then |the get get actual power usage response request should return a get actual power usage response with result @result and description @description, @recordTime, @meterType, @totalConsumedEnergy, @actualConsumedPower, @psldData, @actualCurrent1, @actualCurrent2, @actualCurrent3, @actualPower1, @actualPower2, @actualPower3, @averagePowerFactor1, @averagePowerFactor2, @averagePowerFactor3, @relayData1Index, @relayData1LightingMinutes, @relayData2Index, @relayData2LightingMinutes                             |
                                                                                                                                                                                                                                                                                   |
-| get get actual power usage response input values |
|correlationid|deviceid|isfound|deviceid2|qresult|qdescription    |recordTime    |meterType|totalConsumedEnergy|actualConsumedPower|psldData|actualCurrent1|actualCurrent2|actualCurrent3|actualPower1|actualPower2|actualPower3|averagePowerFactor1|averagePowerFactor2|averagePowerFactor3|relayData1Index|relayData1LightingMinutes|relayData2Index|relayData2LightingMinutes|result   |description     |
|cid-01       |dvc-01  |true   |dvc-01   |OK     |                |20140101120000|AUX      |                   |                   |        |              |              |              |            |            |            |                   |                   |                   |               |                         |               |                         |OK       |                |
|cid-01       |dvc-01  |true   |dvc-01   |OK     |                |20140101120000|AUX      |200                |200                |200     |200           |200           |200           |200         |200         |200         |200                |200                |200                |1              |600                      |2              |480                      |OK       |                |
|cid-01       |dvc-01  |true   |dvc-01   |OK     |                |20140101120000|P1       |100                |100                |100     |100           |100           |100           |100         |100         |100         |100                |100                |100                |1              |600                      |2              |480                      |OK       |                |
|cid-02       |dvc-01  |false  |         |       |                |20140101120000|PULSE    |200                |200                |200     |200           |200           |200           |200         |200         |200         |200                |200                |200                |1              |600                      |2              |480                      |NOT_FOUND|                |
|cid-01       |dvc-01  |true   |dvc-01   |NOT_OK |VALIDATION ERROR|20140101120000|         |                   |                   |        |              |              |              |            |            |            |                   |                   |                   |               |                         |               |                         |NOT_OK   |VALIDATION ERROR|
|cid-03       |dvc-01  |true   |dvc-01   |NOT_OK |VALIDATION ERROR|20140101120000|         |                   |                   |        |              |              |              |            |            |            |                   |                   |                   |               |                         |               |                         |NOT_OK   |VALIDATION ERROR|

!2 Parameters:
 * correlationId: correlation Id returned from a set configuration request
 * content: message content
 * result: OK or exception


!3 !contents -R1 -g -p -f -h