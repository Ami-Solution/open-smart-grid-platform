!2 Narrative
As a platform I want to handle a get power usage history response in order to show power usage history of a device

'''''NOTE: Authorisation is tested in Basic OSGP Functions - PBI119'''''

!2 Implemented Scenarios:
 * Successfully get power usage history
 * Unsuccessfully get power usage history

!2 Scenario: Successfully get power usage history
-| scenario | get power usage history success matrix |device||status||fromDate||untilDate||recordTime||index||meterType||totalConsumedEnergy||actualConsumedPower||psldData||actualCurrent1||actualCurrent2||actualCurrent3||actualPower1||actualPower2||actualPower3||averagePowerFactor1||averagePowerFactor2||averagePowerFactor3||relayData1Index||relayData1LightingMinutes||relayData2Index||relayData2LightingMinutes||ismessagesent||result||description|
|given|a get power usage history request for device @device from @fromDate until @untilDate                                                                                                                                                                                                                                                                                                                                     |
|and  |the get power usage history request refers to a device @device with status @status                                                                                                                                                                                                                                                                                                                                       |
|and  |the get power usage history request refers to an organisation that is authorised                                                                                                                                                                                                                                                                                                                                         |
|and  |the get power usage history oslp message from the device contains @recordTime, @index, @meterType, @totalConsumedEnergy, @actualConsumedPower, @psldData, @actualCurrent1, @actualCurrent2, @actualCurrent3, @actualPower1, @actualPower2, @actualPower3, @averagePowerFactor1, @averagePowerFactor2, @averagePowerFactor3, @relayData1Index, @relayData1LightingMinutes, @relayData2Index and @relayData2LightingMinutes|
|when |the get power usage history request is received                                                                                                                                                                                                                                                                                                                                                                          |
|then |the get power usage history request should return an async response with a correlationId and deviceId @device                                                                                                                                                                                                                                                                                                            |
|and  |a get power usage history oslp message is sent to the device @device should be @ismessagesent                                                                                                                                                                                                                                                                                                                            |
|and  |an ovl get power usage history result message with result @result and description @description should be sent to the ovl out queue                                                                                                                                                                                                                                                                                       |


-| get power usage history success matrix | 
|device   |status|fromDate      |untilDate     |recordTime    |index|meterType|totalConsumedEnergy|actualConsumedPower|psldData|actualCurrent1|actualCurrent2|actualCurrent3|actualPower1|actualPower2|actualPower3|averagePowerFactor1|averagePowerFactor2|averagePowerFactor3|relayData1Index|relayData1LightingMinutes|relayData2Index|relayData2LightingMinutes|ismessagesent|result|description|
|device-01|active|20130202120000|20140202120000|20130202120000|1    |AUX      |                   |                   |        |              |              |              |            |            |            |                   |                   |                   |               |                         |               |                         |true         |OK    |           |
|device-01|active|20120202120000|20130202120000|20130202120000|1    |PULSE    |1000               |200                |100     |240           |360           |12            |15          |15          |15          |15                 |15                 |15                 |1              |600                      |2              |480                      |true         |OK    |           |
|device-01|active|20120202120000|20130202120000|20130202120000|1    |P1       |10                 |400                |400     |140           |160           |112           |115         |15          |15          |15                 |15                 |15                 |1              |600                      |2              |480                      |true         |OK    |           |
|device-01|active|20130202120000|20140202120000|20130202120000|1    |PULSE    |1000               |200                |100     |240           |360           |12            |15          |15          |15          |15                 |15                 |15                 |1              |600                      |2              |480                      |true         |OK    |           |
|device-01|active|20110202120000|20140202120000|20130202120000|1    |AUX      |                   |200                |        |              |360           |12            |15          |15          |15          |15                 |15                 |15                 |1              |600                      |2              |480                      |true         |OK    |           |


!2 Parameters:
 * device: device identification
 * status: active, unknown, unregistered; should always be active for success scenario
 * powerusagedata: the power usage history data
 * correlationId: correlationId of the message
 * isgenerated: boolean (true/false) indicating whether a correlationID is generated
 * isqueued: boolean (true/false) indicating whether a message is added to the queue
 * result: OK (correlationID is returned) or exception


!2 Scenario: Receive A Get get power usage history Response Request
-| scenario | get get power usage history response input values |correlationid||deviceid||isfound||deviceid2||qresult||qdescription||fromDate||untilDate||recordTime||meterType||totalConsumedEnergy||actualConsumedPower||psldData||actualCurrent1||actualCurrent2||actualCurrent3||actualPower1||actualPower2||actualPower3||averagePowerFactor1||averagePowerFactor2||averagePowerFactor3||relayData1Index||relayData1LightingMinutes||relayData2Index||relayData2LightingMinutes||result||description|
|given|a get get power usage history response request with correlationId @correlationid and deviceId @deviceid                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|and  |a get power usage history response message with correlationId @correlationid, deviceId @deviceid2, qresult @qresult, qdescription @qdescription, @fromDate, @untilDate, @recordTime, @meterType, @totalConsumedEnergy, @actualConsumedPower, @psldData, @actualCurrent1, @actualCurrent2, @actualCurrent3, @actualPower1, @actualPower2, @actualPower3, @averagePowerFactor1, @averagePowerFactor2, @averagePowerFactor3, @relayData1Index, @relayData1LightingMinutes, @relayData2Index, @relayData2LightingMinutes is found in the queue @isfound|
|when |the get get power usage history response request is received                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|then|the power usage history response is as expected with result @result and description @description|


-| get get power usage history response input values |
|correlationid|deviceid|isfound|deviceid2|qresult|qdescription    |fromDate      |untilDate     |recordTime    |meterType|totalConsumedEnergy|actualConsumedPower|psldData|actualCurrent1|actualCurrent2|actualCurrent3|actualPower1|actualPower2|actualPower3|averagePowerFactor1|averagePowerFactor2|averagePowerFactor3|relayData1Index|relayData1LightingMinutes|relayData2Index|relayData2LightingMinutes|result   |description     |
|cid-01       |dvc-01  |true   |dvc-01   |OK     |                |20130101120000|20140101120000|20140101120000|AUX      |2050               |3000               |        |240           |360           |12            |15          |15          |15          |15                 |15                 |15                 |1              |600                      |2              |480                      |OK       |                |
|cid-01       |dvc-01  |false  |         |OK     |                |20130101120000|20140101120000|20140101120000|PULSE    |2050               |3000               |        |240           |360           |12            |15          |15          |15          |15                 |15                 |15                 |1              |600                      |2              |480                      |NOT_FOUND|                |
|cid-01       |dvc-01  |false  |         |NOT_OK |VALIDATION ERROR|20130101120000|20140101120000|20140101120000|         |                   |                   |        |              |              |              |            |            |            |                   |                   |                   |               |                         |               |                         |NOT_OK   |VALIDATION ERROR|


!3 !contents -R1 -g -p -f -h